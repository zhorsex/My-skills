---
name: report-generator
description: Generate engineering/technical reports with strict chapter confirmation, multi-level search depth, automatic chart generation, terminology management, real-time learning, and self-iteration capabilities. Use when user needs to create structured technical reports from reference documents and outlines, ensuring data authenticity and user approval at each stage.
---

# Report Generator

## Overview

Generate high-quality engineering/technical reports with AI assistance while maintaining strict quality control through chapter-by-chapter user confirmation.

## 使用此Skill

**何时触发此技能**：
- 用户需要创建工程技术报告
- 用户提供了参考文档和大纲
- 用户需要逐章确认的严格质量控制
- 用户需要自动生成图表
- 用户需要术语一致性管理
- 用户需要Word格式输出
- 用户需要每个章节生成独立的Markdown文件
- 用户需要最后统一合成完整报告

**典型场景**：
- "帮我根据这些文档和大纲生成一份工程技术报告"
- "我需要写一份风电场建设方案，请根据大纲逐章编写"
- "请根据参考资料编写技术报告，每章写完让我确认，并生成独立文件"
- "帮我生成技术报告，每章写成独立md文件，图表嵌入其中，最后合成Word"

## 工作流程决策树

```
开始
  ↓
阶段1：初始化与需求收集
  - 收集参考文档
  - 收集大纲/模板
  - 确认基本信息
  - 初始化术语表
  - 创建输出目录结构（chapters/, charts/, assets/）
  ↓
阶段2：逐章编写（严格确认模式 + 章节文件生成）
  - 章节规划（资料搜集深度、图表需求）
  - 资料准备与搜集（多级深度）
  - 内容编写（技术准确性、术语管理）
  - 图表生成（自动生成多种图表）
  - 章节确认（用户必须批准）
  - 生成章节Markdown文件（包含嵌入的图表）
  - 重复下一章
  ↓
阶段3：整合与完善
  - 合并所有章节文件
  - 全文术语一致性检查
  - 风格统一性检查
  - 逻辑连贯性检查
  - 生成补充内容（目录、封面、参考文献）
  - 最终预览
  ↓
阶段4：生成Word文档
  - 选择转换方案（用户选择：Pandoc/Python脚本/docx skill）
  - 执行转换（根据用户选择的方案）
  - 应用格式（标题样式、正文样式）
  - 保存文件
```

## 阶段1：初始化与需求收集

### 步骤1.1 - 收集参考文档

询问："请提供本次报告需要参考的文档路径列表（支持：Word、PDF、Markdown等）"

操作：
- 逐个读取并分析文档内容
- 提取关键信息：技术参数、工程数据、案例资料、结论建议等
- 生成"参考资料索引"记录来源和可用内容

### 步骤1.2 - 收集大纲/模板

询问："请提供大纲文件路径或直接输入大纲结构"

操作：
- 解析大纲层次：章（一级标题）→ 节（二级标题）→ 小节（三级标题）
- **仅使用大纲结构**，忽略格式样式
- 生成"章节层次树"

### 步骤1.3 - 确认基本信息

收集以下信息：
```
→ 报告标题：____________________
→ 报告类型：工程技术报告
→ 目标读者：____________________
→ 总体字数范围：____________________
→ 输出文件路径：____________________
```

### 步骤1.4 - 初始化术语表

创建"术语表"空模板，结构：
```
| 术语 | 统一定义 | 首次出现位置 | 备注 | 使用频率 |
```

### 步骤1.5 - 创建输出目录结构

操作：
1. 在工作目录下创建以下目录结构：
   ```
   [项目目录]/
   ├── chapters/              # 章节Markdown文件目录
   ├── charts/               # 图表文件目录
   ├── assets/               # 其他资源文件目录
   ├── references/           # 参考资源目录
   ├── iteration/            # 迭代系统目录
   └── scripts/              # 脚本目录
   ```
2. 验证目录创建成功
3. 创建 README 文件记录目录用途
4. 准备章节文件清单（空模板）
5. 准备图表清单（空模板）

**章节文件清单模板**：
```markdown
# 章节文件清单

| 章节 | 文件名 | 字数 | 图表数 | 状态 | 创建时间 |
|------|--------|------|--------|------|----------|
```

**图表清单模板**：
```markdown
# 图表清单

| 图表编号 | 文件名 | 所属章节 | 图表类型 | 创建时间 |
|----------|--------|----------|----------|----------|
```

## 阶段2：逐章编写（严格确认模式 + 章节文件生成）

对每个章节执行以下流程：

### 步骤2.1 - 章节规划

1. 显示当前章节标题（如：第3章 工程设计方案）
2. 分析本章包含哪些小节
3. 询问："本章是否需要搜集专业资料？"
   - 选项：工程规范、技术标准、行业数据、案例资料
4. 询问："资料搜集的深度要求？"
   - A. 🔍 快速搜索 (1-2个来源, 3-5分钟)
   - B. 📚 标准搜索 (3-5个来源, 8-10分钟)
   - C. 🔬 深度搜索 (6-10个来源, 15-20分钟)
   - D. 🌐 广泛搜索 (10-15个来源, 30-40分钟)
5. 询问："本章需要生成哪些图表？"
   - 选项：流程图、柱状图、折线图、饼图、表格
6. 询问："本章的目标字数范围？"
7. 自动记录选择到 usage-log.md

### 步骤2.2 - 资料准备与搜集

操作：
- 优先从"参考资料索引"中提取相关内容
- 优先检查资料缓存（iteration/cache/）
- 如需要在线搜集：
  - 根据选择的深度执行搜索策略（见search-strategies.md）
  - 验证资料真实性和权威性
  - 记录来源和验证结果
- 交叉验证多个来源的数据
- 生成"本章资料清单"

**搜索深度策略**：

| 深度级别 | 资料数量 | 时间预算 | 验证标准 | 适用场景 |
|---------|---------|---------|---------|---------|
| 快速搜索 | 1-2个 | 3-5分钟 | 来源可信赖、信息一致 | 通用概念、基础原理 |
| 标准搜索 | 3-5个 | 8-10分钟 | 至少2个来源一致、有时间标注 | 技术方案、数据分析 |
| 深度搜索 | 6-10个 | 15-20分钟 | 至少3个来源交叉验证、研究方法透明 | 核心技术、创新方案 |
| 广泛搜索 | 10-15个 | 30-40分钟 | 至少5个来源、多重验证、权威背书 | 前沿技术、学术级研究 |

### 步骤2.3 - 内容编写

操作：
- 遍历每个小节：
  1. 编写段落内容（1-2段/小节）
  2. 保持技术准确性
  3. 使用规范的工程技术语言
  4. 遇到新术语：
     - 添加到"术语表"
     - 在首次出现时给出简明定义
  5. 引用参考资料时，使用非正式引用
     - 格式："根据《XXX报告》..."、"YYY标准（2023版）要求..."
- 确保字数在目标范围内
- 检查逻辑连贯性
- 生成"本章草稿"

### 步骤2.4 - 图表生成

如需图表：
1. 分析数据类型和表达需求
2. 选择合适的图表类型（见chart-patterns.md）
3. 从 patterns/chart-configs.md 应用配置
4. 生成图表（使用scripts/generate_chart.py）
5. 将图表文件保存到 `charts/` 目录
   - 命名格式：`第N章-图表类型-序号.png`
   - 例如：`第3章-流程图-1.png`、`第5章-柱状图-2.png`
6. 在 Markdown 内容中嵌入图表：
   ```markdown
   ![图表说明](../charts/第3章-流程图-1.png)

   *图X-Y：图表标题*
   ```
   - 使用相对路径引用图表
   - X 为章节编号，Y 为章节内图表序号
   - 添加图表标题和说明
7. 生成"本章图表清单"

**图表类型与应用场景**：

| 图表类型 | 生成工具 | 输出格式 | 适用场景 |
|---------|---------|---------|---------|
| 流程图 | Mermaid | SVG/PNG | 工艺流程、工程流程 |
| 柱状图 | Python Matplotlib | PNG | 数据对比、统计展示 |
| 折线图 | Python Matplotlib | PNG | 趋势分析、时间序列 |
| 饼图 | Python Matplotlib | PNG | 占比分析、构成展示 |
| 表格 | Markdown | - | 数据展示、参数对比 |

**图表嵌入示例**：

```markdown
## 3.2 工艺流程设计

本工程采用以下工艺流程：

![工艺流程图](../charts/第3章-流程图-1.png)

*图3-1：风电场施工工艺流程图*

流程说明：
1. 场地平整
2. 基础施工
3. 设备安装
4. 调试验收
```

### 步骤2.5 - 章节确认（严格确认模式）

操作：
1. 展示本章内容预览（包括文字和图表）
2. 询问用户意见：
   "本章内容是否符合要求？"
   选项：
   - A. 完全符合，继续下一章
   - B. 需要修改（请说明修改意见）
   - C. 需要重写（请说明重写方向）
3. 根据反馈调整内容
4. 确认后标记本章为"已完成"
5. 自动记录到 feedback-log.md
6. 更新"进度跟踪表"

**注意**：每章必须用户确认后才能继续下一章，这是严格确认模式。

### 步骤2.6 - 生成章节Markdown文件

操作：
1. 为当前章节创建独立的 Markdown 文件
   - 文件路径：`chapters/第N章-章节标题.md`
   - 使用中文文件名，方便识别
2. 文件结构：
   ```markdown
   ---
   chapter: N
   title: 章节标题
   word_count: 实际字数
   charts: [图表1.png, 图表2.png]
   ---
   
   # 章节标题
   
   ## 小节标题1
   
   内容...
   
   ## 小节标题2
   
   内容...
   
   <!-- 图表嵌入 -->
   ![图表说明](../charts/图表1.png)
   
   *图X-1：图表标题*
   
   ```
3. 处理图表：
   - 将生成的图表保存到 `charts/` 目录
   - 使用相对路径 `../charts/` 引用图表
   - 图表文件命名：`第N章-图表类型-序号.png`（如：第3章-流程图-1.png）
   - 在 md 文件中使用标准 Markdown 语法嵌入图片
   - 添加图片标题和编号（如：*图3-1：工艺流程图*）
4. 使用 frontmatter 记录元数据：
   - chapter: 章节序号
   - title: 章节标题
   - word_count: 本章字数
   - charts: 本章使用的图表列表
5. 验证文件完整性
   - 检查 Markdown 语法是否正确
   - 验证图表链接是否有效
   - 确认字符编码为 UTF-8
6. 记录到"章节文件清单"

**章节文件清单结构**：
```markdown
# 章节文件清单

| 章节 | 文件名 | 字数 | 图表数 | 状态 |
|------|--------|------|--------|------|
| 第1章 | chapters/第1章-项目背景与目标.md | 2345 | 2 | ✅ 已完成 |
| 第2章 | chapters/第2章-技术方案概述.md | 1890 | 1 | ✅ 已完成 |
```

## 阶段3：整合与完善

### 步骤3.1 - 合并所有章节文件

操作：
1. 使用脚本 `scripts/merge_chapters.py` 合并所有章节文件
   - 按章节顺序读取所有章节文件
   - 读取 frontmatter 元数据
   - 生成完整报告的 Markdown 文件
   - 文件路径：`report-complete.md`
2. 合并后的文件结构：
   ```markdown
   <!-- 封面 -->
   # [报告标题]
   
   <!-- 目录（自动生成）-->
   ## 目录
   
   <!-- 章节内容（按顺序合并）-->
   <!-- 每章之间添加分页符标记 -->
   
   <!-- 参考文献 -->
   ## 参考文献
   
   <!-- 附录 -->
   ## 附录
   ```
3. 处理章节间的过渡
   - 确保章节编号连续
   - 调整图表编号为全局编号（图1、图2...）
   - 保持标题层级一致
4. 验证合并结果
   - 检查章节完整性
   - 验证图表链接有效
   - 确认格式一致性

### 步骤3.2 - 全文术语一致性检查

### 步骤3.1 - 全文术语一致性检查

操作：
- 遍历"术语表"
- 检查全文术语使用是否一致
- 如发现不一致：
  - 列出冲突项
  - 询问统一方式
  - 执行批量替换
- 生成"术语一致性报告"

### 步骤3.2 - 全文风格统一性检查

检查：
- 标题层级是否规范
- 段落长度是否合理
- 技术语言是否统一
- 引用格式是否一致
- 生成"风格统一性报告"

### 步骤3.3 - 章节逻辑连贯性检查

检查：
- 章节间过渡是否自然
- 是否有内容重复或矛盾
- 是否有信息缺失
- 生成"逻辑连贯性报告"

### 步骤3.4 - 补充内容

生成：
- 目录（自动）
- 封面（包含：标题、日期、作者等）
- 参考文献列表（非正式引用格式）
- 附录（如需要）

### 步骤3.5 - 最终预览

1. 展示完整报告预览（关键部分）
2. 询问："报告是否符合预期？"
   - A. 完全符合，准备输出
   - B. 需要调整（请说明调整内容）
3. 根据反馈完成最终调整

## 阶段4：生成Word文档

### 步骤4.1 - 选择转换方案

操作：
1. 询问用户："请选择将 Markdown 转换为 Word 文档的方案："

   **选项A：使用 Pandoc 转换**（推荐）
   - 优点：强大的 Markdown 支持，处理图表和表格效果好，转换速度快
   - 缺点：需要提前安装 Pandoc
   - 适用场景：大多数工程技术报告，图表较多的情况

   **选项B：使用 Python 脚本转换**（推荐）
   - 优点：可自定义转换逻辑，格式控制精细，使用 python-docx 库
   - 缺点：需要 Python 环境
   - 适用场景：需要自定义格式或精细控制的情况

   **选项C：使用 docx skill 转换**
   - 优点：直接使用 skill，无需额外工具，可实时调整
   - 缺点：对复杂 Markdown 语法支持可能不够完善
   - 适用场景：简单文档或需要精细控制的场景

2. 等待用户选择（A、B 或 C）

### 步骤4.2 - 执行转换

根据用户选择执行对应的转换方案：

#### 方案A：使用 Pandoc 转换

操作：
1. 检查 Pandoc 是否已安装
2. 执行命令：
   ```bash
   pandoc report-complete.md -o "[报告标题].docx" \
     --reference-doc=templates/pandoc-template.docx \
     --toc \
     --number-sections
   ```
3. 如果没有模板，使用默认样式：
   ```bash
   pandoc report-complete.md -o "[报告标题].docx" --toc
   ```
4. 验证转换结果
5. 显示转换完成信息

#### 方案B：使用 Python 脚本转换

操作：
1. 执行转换脚本：
   ```bash
   python scripts/convert_to_docx.py \
     --input report-complete.md \
     --output "[报告标题].docx" \
     --template templates/docx-template.docx
   ```
2. 脚本功能：
   - 使用 python-docx 库读取 Markdown 文件
   - 解析 Markdown 标记（标题、列表、表格、图片）
   - 应用专业格式模板
   - 处理图表嵌入（从 charts/ 目录）
   - 生成最终 Word 文档
3. 验证转换结果
4. 显示转换完成信息

#### 方案C：使用 docx skill 转换

操作：
1. 读取 `report-complete.md` 文件
2. 使用 /docx skill 创建 Word 文档
3. 解析 Markdown 标记（标题、列表、表格、图片）
4. 应用格式：
   - 标题样式（Heading 1/2/3）
   - 正文样式
   - 页眉页脚（页码）
   - 段落间距和缩进
5. 插入所有图表（从 charts/ 目录）
6. 保存为 .docx 文件
7. 验证转换结果
8. 显示转换完成信息

### 步骤4.3 - 输出文件

操作：
1. 保存到用户指定路径
2. 文件名：[报告标题].docx
3. 生成输出确认信息
4. 提示："文件已保存到：[路径]"

## 自动迭代系统

本skill包含完整的自动迭代系统，实现实时学习、经验积累和自我进化。

### 核心理念

**实时学习 + 人工确认 + 共享资源库**

每次使用都收集反馈，积累经验模式，自动分析优化，生成改进建议，等待人工确认后应用。优秀模式提取到共享资源库，跨实例复用。

### 迭代系统组件

#### 1. 反馈收集

- **实时记录章节反馈**：满意度（1-5星）、修改次数和修改类型、具体意见和用户原话
- **记录整体评价**：整体满意度（1-5星）、总耗时、用户评价和反馈
- **AI自我分析**：问题识别、原因分析、改进机会、经验总结

#### 2. 使用日志

记录：
- 基本信息：报告标题、类型、目标读者、章节数量、总字数、使用时长
- 章节明细：每个章节的字数、修改次数、反馈满意度、耗时
- 图表使用记录：图表类型、生成方式、用户评价
- 个性化偏好：写作风格、图表偏好、字数倾向、术语使用

#### 3. 经验模式积累

- **章节模板积累**（patterns/chapter-templates.md）：使用场景、标准结构、写作要点、用户反馈总结
- **常用术语积累**（patterns/common-terms.md）：定义、使用频率、使用场景、优化版本
- **图表配置积累**（patterns/chart-configs.md）：使用场景、代码模板、风格偏好、用户评价
- **写作风格模式**（patterns/writing-styles.md）：语言特征、术语使用、数据使用、段落长度

#### 4. 自我评估

- **实时评估**：内容质量、工作效率、用户体验
- **定期评估**：每完成10次使用后深度分析
- **评估指标**：技术准确性、术语一致性、数据真实性、风格统一性、逻辑连贯性

#### 5. 更新建议

基于评估结果生成改进建议，展示给用户，等待用户确认后才应用。

#### 6. 共享资源库

- **提取阶段**：从本地到共享（每完成10次使用后触发）
- **使用阶段**：从共享到本地（每次使用初始化时加载）
- **优先级**：共享模式优先级高于本地模式
- **冲突处理**：使用满意度更高的版本

## 关键约束

❌ **不编造数据**：所有数据必须来源于可靠资料
❌ **不超出大纲**：严格按照用户提供的大纲结构
❌ **不跳过确认**：每章必须用户确认
❌ **不使用复杂引用**：采用非正式引用格式
❌ **不强制更新**：所有迭代都需要用户批准

## 资源说明

### 输出目录结构

在阶段1初始化时创建以下目录结构：

```
[项目根目录]/
├── chapters/              # 章节Markdown文件目录
│   ├── 第1章-项目背景与目标.md
│   ├── 第2章-技术方案概述.md
│   └── ...
├── charts/               # 图表文件目录
│   ├── 第1章-流程图-1.png
│   ├── 第2章-柱状图-1.png
│   └── ...
├── assets/               # 其他资源文件目录
│   └── ...
├── report-complete.md   # 合并后的完整报告
└── [报告标题].docx      # 最终Word文档
```

### references/

参考资源目录，包含：
- `engineering-terms.md` - 工程术语库模板
- `citation-sources.md` - 资料来源库模板
- `chart-patterns.md` - 图表模式库模板

这些文档提供模板和参考信息，Claude在执行任务时可以查阅。

### iteration/

迭代系统目录，包含：
- `feedback-log.md` - 用户反馈日志模板
- `usage-log.md` - 使用记录日志模板
- `search-strategies.md` - 搜索深度策略配置
- `patterns/` - 经验模式库（章节模板、常用术语、图表配置、写作风格）
- `evaluations/` - 自我评估报告
- `suggestions/update-proposals.md` - 更新建议
- `cache/` - 资料缓存库（工程规范、技术标准、行业数据、案例资料）
- `shared/` - 共享资源库（跨实例复用）
- `local/` - 本地私有资源

### scripts/

可执行脚本目录，包含：

**图表生成脚本：**
- `generate_chart.py` - 图表生成脚本（支持Mermaid和Python Matplotlib）
  - 输入：图表类型、数据、配置参数
  - 输出：PNG/JPG图片文件，保存到 charts/ 目录

**资料管理脚本：**
- `cache_manager.py` - 资料缓存管理脚本
- `analyze_usage.py` - 使用分析脚本

**章节合并脚本：**
- `merge_chapters.py` - 章节合并脚本
  - 读取所有 chapters/ 目录下的 Markdown 文件
  - 按章节顺序合并
  - 处理 frontmatter 元数据
  - 生成完整的 report-complete.md
  - 调整图表编号为全局编号

**文档转换脚本：**
- `convert_to_docx.py` - Markdown转Word脚本
  - 读取 report-complete.md
  - 使用 python-docx 库
  - 应用格式模板
  - 生成最终的 Word 文档

这些脚本可以直接执行，用于自动化操作。

## 术语管理

术语管理是本skill的重要功能，确保报告中的术语使用一致。

### 术语表结构

| 术语 | 统一定义 | 首次出现位置 | 备注 | 使用频率 |

### 术语一致性检查

- 检查全文术语使用是否一致
- 发现不一致时询问统一方式
- 执行批量替换
- 生成一致性报告

## 资料搜集

本skill支持四级资料搜集深度，根据需求灵活选择。

### 搜索深度级别

1. **快速搜索**：1-2个来源，3-5分钟
2. **标准搜索**：3-5个来源，8-10分钟
3. **深度搜索**：6-10个来源，15-20分钟
4. **广泛搜索**：10-15个来源，30-40分钟

详细配置见 iteration/search-strategies.md

## 图表生成

本skill支持自动生成多种图表类型。

### 支持的图表类型

- 流程图（Mermaid）
- 柱状图（Python Matplotlib）
- 折线图（Python Matplotlib）
- 饼图（Python Matplotlib）
- 表格（Markdown）

详细图表模式和配置见 references/chart-patterns.md 和 patterns/chart-configs.md

## 章节文件格式

### 文件结构

每个章节 Markdown 文件遵循以下标准结构：

```markdown
---
chapter: N
title: 章节标题
word_count: 2345
charts:
  - 第N章-流程图-1.png
  - 第N章-柱状图-1.png
created: 2026-01-30
status: completed
---

# 第N章 章节标题

## N.1 小节标题1

段落内容...

段落内容...

## N.2 小节标题2

段落内容...

<!-- 图表嵌入 -->

![图表说明](../charts/第N章-流程图-1.png)

*图N-1：图表标题*

## N.3 小节标题3

段落内容...

<!-- 表格示例 -->

| 参数 | 数值 | 单位 | 备注 |
|------|------|------|------|
| 功率 | 2.5 | MW | 单机容量 |
| 高度 | 100 | m | 塔筒高度 |
| 直径 | 120 | m | 叶轮直径 |

*表N-1：技术参数表*

```

### Frontmatter 说明

每个章节文件开头必须包含 frontmatter（YAML 格式）：

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| chapter | 整数 | 是 | 章节序号（1, 2, 3...） |
| title | 字符串 | 是 | 章节标题 |
| word_count | 整数 | 是 | 本章实际字数 |
| charts | 数组 | 否 | 本章使用的图表文件列表 |
| created | 日期 | 否 | 创建日期 |
| status | 字符串 | 否 | 状态（completed/draft） |

### 章节文件命名规则

- 格式：`第N章-章节标题.md`
- 示例：
  - `第1章-项目背景与目标.md`
  - `第2章-技术方案概述.md`
  - `第3章-工程设计方案.md`

### 图表嵌入规则

1. **图片路径**：使用相对路径 `../charts/`
2. **命名格式**：`第N章-图表类型-序号.png`
3. **编号规则**：
   - 章节内：图N-1、图N-2...
   - 全局（合并后）：图1、图2...
4. **标题格式**：`*图N-Y：图表标题*`（斜体）
5. **示例**：
   ```markdown
   ![工艺流程图](../charts/第3章-流程图-1.png)

   *图3-1：风电场施工工艺流程图*
   ```

### 表格规则

1. 使用标准 Markdown 表格语法
2. 表格编号：表N-Y
3. 标题格式：`*表N-Y：表格标题*`（斜体）
4. 示例：
   ```markdown
   | 参数 | 数值 | 单位 | 备注 |
   |------|------|------|------|
   | 功率 | 2.5 | MW | 单机容量 |

   *表3-1：风机技术参数*
   ```

### 章节文件示例

完整示例见 `references/chapter-template.md`。

## Word输出

本skill支持多种方式生成Word格式报告。

### 输出流程

```
1. 生成章节Markdown文件（chapters/*.md）
        ↓
2. 合并为完整报告（report-complete.md）
        ↓
3. 转换为Word文档（[报告标题].docx）
```

### 转换方式

**方式1：Pandoc 转换（推荐）**
- 优点：强大的 Markdown 支持，处理图表和表格效果好
- 使用方法：`pandoc report-complete.md -o [报告标题].docx --reference-doc=templates/pandoc-template.docx`
- 需要：安装 Pandoc，准备 Word 模板

**方式2：Python 脚本转换**
- 脚本：`scripts/convert_to_docx.py`
- 库：python-docx
- 优点：可自定义转换逻辑，格式控制精细
- 使用方法：执行脚本，自动读取 report-complete.md 并转换

**方式3：docx skill**
- 优点：直接使用 skill，无需额外工具
- 适用：简单文档或需要实时调整的场景
- 限制：对复杂 Markdown 语法支持可能不够完善
- 详细使用方法见 docx skill 的 SKILL.md 文档

### 图表处理

无论使用哪种转换方式，图表处理流程：

1. 图表已保存在 `charts/` 目录
2. Markdown 文件中使用相对路径引用
3. 转换时自动嵌入到 Word 文档中
4. 保持图表的清晰度和格式

### 格式模板

推荐使用 Word 格式模板：
- `templates/pandoc-template.docx` - Pandoc 转换模板
- 包含预定义的样式（标题、正文、表格、图片）
- 统一的页眉页脚和页码格式
- 符合工程技术报告规范

## 工作进度跟踪

在章节编写过程中，实时显示工作进度：

```
╔══════════════════════════════════════════════════════╗
║         文档生成进度                                     ║
╠══════════════════════════════════════════════════════╣
║                                                          ║
║  总体进度：██████████████████░░░░░  60% (6/10章)      ║
║                                                          ║
║  已完成章节：                                            ║
║  ✅ 第1章 项目背景与目标 (2345字, 2图)                   ║
║     → 文件: chapters/第1章-项目背景与目标.md              ║
║  ✅ 第2章 技术方案概述 (1890字, 1图)                      ║
║     → 文件: chapters/第2章-技术方案概述.md                ║
║  ✅ 第3章 工程设计方案 (3120字, 3图)                      ║
║     → 文件: chapters/第3章-工程设计方案.md                ║
║  ⬜ 第4章 施工组织设计 (进行中, 60%)                       ║
║  ⬜ 第5章 质量保证措施                                    ║
║                                                          ║
║  当前章节：第4章 施工组织设计                              ║
║  当前进度：内容编写 (60%)                                 ║
║  当前任务：生成工艺流程图                                 ║
║  预计剩余时间：10分钟                                      ║
║                                                          ║
║  文件统计：                                              ║
║  - 章节文件: 3 个                                         ║
║  - 图表文件: 6 个                                         ║
║  - 总字数: 7355 字                                        ║
║                                                          ║
╚══════════════════════════════════════════════════════╝
```

在阶段4（生成Word文档）时，进度显示：

```
╔══════════════════════════════════════════════════════╗
║         文档生成进度                                     ║
╠══════════════════════════════════════════════════════╣
║                                                          ║
║  总体进度：███████████████████████  100%               ║
║                                                          ║
║  已完成章节：                                            ║
║  ✅ 第1章 项目背景与目标 (2345字, 2图)                   ║
║  ✅ 第2章 技术方案概述 (1890字, 1图)                      ║
║  ✅ 第3章 工程设计方案 (3120字, 3图)                      ║
║  ✅ 第4章 施工组织设计 (2850字, 2图)                      ║
║  ✅ 第5章 质量保证措施 (1950字, 1图)                      ║
║                                                          ║
║  整合与完善：✅ 已完成                                     ║
║  - 合并章节文件：✅ 完成                                  ║
║  - 一致性检查：✅ 完成                                   ║
║  - 补充内容：✅ 完成                                      ║
║                                                          ║
║  当前阶段：阶段4 - 生成Word文档                            ║
║  当前进度：等待用户选择转换方案                            ║
║  当前任务：选择转换方案（Pandoc/Python/docx skill）        ║
║                                                          ║
║  文件统计：                                              ║
║  - 章节文件: 5 个                                         ║
║  - 图表文件: 9 个                                         ║
║  - 总字数: 12155 字                                       ║
║  - 合并报告: report-complete.md                          ║
║                                                          ║
╚══════════════════════════════════════════════════════╝
```

## 常见问题

**Q: 为什么要生成独立的章节 Markdown 文件？**
A: 独立章节文件的优势：
- 便于逐章编辑和修改，修改某章不影响其他章节
- 支持版本控制，可以追踪每章的变更历史
- 便于多人协作，不同人可以同时编写不同章节
- 灵活重组章节顺序，快速生成不同版本的报告
- 便于模块化管理，章节可以复用于其他报告

**Q: 章节文件和图表如何保持关联？**
A: 通过以下方式：
- 图表统一保存在 `charts/` 目录
- 使用标准化的命名格式（`第N章-图表类型-序号.png`）
- 在章节 Markdown 文件中使用相对路径引用（`../charts/`）
- 使用 frontmatter 记录章节使用的图表列表
- 合并时自动处理图表编号和引用

**Q: 如何修改已经确认的章节？**
A: 可以直接编辑对应的章节 Markdown 文件：
- 打开 `chapters/` 目录下的相应文件
- 修改内容后保存
- 重新运行合并脚本生成完整报告
- 重新转换为 Word 文档

**Q: 合并脚本如何处理图表编号？**
A: 合并脚本会自动处理：
- 读取每章的图表数量
- 将章节内编号（如图3-1、图3-2）转换为全局编号（如图1、图2、图3...）
- 更新图表标题和引用
- 生成图表索引目录

**Q: 可以跳过章节确认吗？**
A: 不可以。严格确认模式要求每章必须用户确认后才能继续下一章。这是确保报告质量的关键机制。

**Q: 资料搜集时间可以调整吗？**
A: 可以。每个深度级别都有时间预算，但根据实际情况可以适当延长或缩短。

**Q: 如何确保数据真实性？**
A: 本skill采用多级验证机制：来源验证、交叉引用、事实检查。所有数据必须来源于可靠资料，不编造数据。

**Q: 迭代系统如何工作？**
A: 每次使用后收集反馈，积累经验模式，自动分析优化，生成改进建议。所有更新需要用户确认后才应用。

**Q: 如何选择Word转换方案？**
A: 根据以下建议选择：
- **Pandoc（方案A）**：图表较多、转换速度要求高、已安装 Pandoc
- **Python脚本（方案B）**：需要自定义格式、有 Python 环境、需要精细控制
- **docx skill（方案C）**：简单文档、没有其他工具、需要实时调整

在转换阶段，系统会提供三种方案的详细说明，您可以根据实际需求选择最合适的方案。

**Q: 可以生成非Word格式吗？**
A: 当前版本主要支持Word格式输出，但也支持 Markdown 格式的完整报告（report-complete.md）。如果需要其他格式（PDF、HTML等），可以使用 Pandoc 转换或等待后续版本支持。

## 完成标准

报告生成完成的标准：

**章节编写阶段：**
- [ ] 所有章节编写完成且用户确认
- [ ] 所有章节 Markdown 文件已生成（chapters/ 目录）
- [ ] 所有图表文件已生成并嵌入到对应章节（charts/ 目录）
- [ ] 章节文件的 frontmatter 完整且正确

**整合与完善阶段：**
- [ ] 所有章节文件已合并为完整报告（report-complete.md）
- [ ] 术语一致性检查通过
- [ ] 风格统一性检查通过
- [ ] 逻辑连贯性检查通过
- [ ] 图表编号已转换为全局编号
- [ ] 目录、封面、参考文献等补充内容已生成

**输出阶段：**
- [ ] Word 文档成功生成（[报告标题].docx）
- [ ] Word 文档格式正确（标题、正文、图表等）
- [ ] 所有图表在 Word 文档中显示正常
- [ ] 用户对最终报告满意

**文件完整性检查：**
- [ ] 章节文件数量 = 章节数量
- [ ] 图表文件数量与章节文件中的列表一致
- [ ] 所有图表链接有效
- [ ] 文件编码为 UTF-8
